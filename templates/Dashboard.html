<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/static/css/bootstrap.css">
    <link rel="stylesheet" href="/static/css/bootstrap-grid.css">
    <link rel="stylesheet" href="/static/css/bootstrap-reboot.css">
    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/bootstrap.bundle.js"></script>
    <script src="/static/js/cyj-line_chart.js"></script>
</head>
<body>
<!--导航栏-->
<nav class="navbar navbar-expand-md navbar-light">

  <!-- 大标题 -->
  <a class="navbar-brand" href="#">CRM Server Monitor</a>

  <!-- 定义导航栏在小屏幕中的折叠按钮-->
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>

  <!-- 导航栏中放置的链接 -->
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
    </ul>
  </div>
</nav>

<!--主体部分-->
<div class="container-fluid bg-light">

  <!--放置CPU Line Chart的行-->
  <div class="row">
      <div class="col-12">
        <div class="card card-chart">

          <!--卡片的头部-->
          <div class="card-header bg-white">
            <div class="row">

              <!--卡片头部的左半边-->
              <div class="col-sm-6 text-left">
                <h5 class="card-title">CPU Utility Rate</h5>
              </div>

              <!--卡片头部的右半边-->
              <div class="col-sm-6"></div>

            </div>
          </div>

          <!--卡片的主体-->
          <div class="card-body bg-white">

            <!--CPU的表-->
            <div id="cpu_dashboard" style="width: 100%;height:300px;"></div>

            <!--初始化cpuCharts的代码-->
            <script type="text/javascript">
                // 初始化cpuCharts实例
                var cpuChart = echarts.init(document.getElementById('cpu_dashboard'),'cyj-line_chart');

                // 声明有关CPU数据的全局变量
                var cpu_data = {{ data.cpu_data|safe }};
                var cpu_date = {{ data.cpu_date|safe }};

                // 指定图表的配置项和数据
                var cpu_line_chart_option = {
                    tooltip: {},
                    legend: {
                        data:['使用率']
                    },
                    xAxis: {
                        data: cpu_date
                    },
                    yAxis: {},
                    series: [{
                        name: '使用率',
                        type: 'line',
                        data: cpu_data
                    }],
                    color:['#c728a2']
                };
                // 使用刚指定的配置项和数据显示图表。
                cpuChart.setOption(cpu_line_chart_option);
            </script>
          </div>
          </div>
        </div>
  </div>

  <!--放置四个实时显示数据的框的行-->
  <div class="row bg-white">

      <!--左1 CPU Pie Chart-->
      <div class="col-sm-3 bg-white">

          <!--声明一个新卡片-->
          <div class="card card-chart">

              <!--卡片的头部-->
              <div class="card-header bg-white">
                <h4 class="text-center"><small>CPU</small></h4>
              </div>

              <!--卡片的主体-->
              <div class="card-body bg-white">

                  <!--CPU实时数据的图-->
                  <div class="row">
                      <div class="col-sm-6">

                          <!--声明用来放CPU Pie Chart的DOM-->
                          <div id="cpu_pie_chart" style="width: 100%;height:150px;"></div>

                          <!--初始化CPU Pie Chart-->
                          <script>
                              var cpu_pie_chart = echarts.init(document.getElementById('cpu_pie_chart'));
                              var cpu_pie_chart_option = {
                                    tooltip: {
                                    trigger: 'item',
                                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                                    },
                                    color:['green', 'white'],
                                    series: [
                                        {
                                            name: 'CPU',
                                            type: 'pie',
                                            radius: ['50%', '70%'],
                                            avoidLabelOverlap: false,
                                            label: {
                                                normal: {
                                                position: 'inner',
                                                show : false
                                                }
                                            },
                                            labelLine:{
                                                show: false
                                            },
                                            emphasis: {
                                                label: {
                                                    show: true,
                                                    fontSize: '30',
                                                    fontWeight: 'bold'
                                                }
                                            },
                                            data: [
                                                {value: 90, name: 'CPU使用率'},
                                                {value: 10, name: '空闲'},
                                            ]
                                        }
                                    ]
                            };
                            cpu_pie_chart.setOption(cpu_pie_chart_option);
                          </script>
                      </div>

                  <!--CPU实时数据的数字-->
                  <div class="col-sm-6">
                      <p class="font-weight-light text-center">Real Time</p>
                      <p class="font-weight-light text-center">CPU Utility Rate</p>
                      <p class="text-center font-weight-bold lead" id="cpu_real_time_data">Loading...</p>
                  </div>
                  </div>
              </div>
          </div>
      </div>

      <!--左2 Memory Pie Chart-->
      <div class="col-sm-3">
          <!--声明一个新卡片-->
          <div class="card card-chart">

              <!--卡片的头部-->
              <div class="card-header bg-white">
                <h4 class="text-center"><small>Memory</small></h4>
              </div>

              <!--卡片的主体-->
              <div class="card-body bg-white">

                  <!--Memory实时数据的图-->
                  <div class="row">
                      <div class="col-sm-6">

                          <!--声明用来放Memory Pie Chart的DOM-->
                          <div id="memory_pie_chart" style="width: 100%;height:150px;"></div>

                          <!--初始化Memory Pie Chart-->
                          <script>
                              var memory_pie_chart = echarts.init(document.getElementById('memory_pie_chart'));
                              var memory_pie_chart_option = {
                                    tooltip: {
                                    trigger: 'item',
                                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                                    },
                                    color:['green', 'white'],
                                    series: [
                                        {
                                            name: 'Memory',
                                            type: 'pie',
                                            radius: ['50%', '70%'],
                                            avoidLabelOverlap: false,
                                            label: {
                                                normal: {
                                                position: 'inner',
                                                show : false
                                                }
                                            },
                                            labelLine:{
                                                show: false
                                            },
                                            emphasis: {
                                                label: {
                                                    show: true,
                                                    fontSize: '30',
                                                    fontWeight: 'bold'
                                                }
                                            },
                                            data: [
                                                {value: 90, name: 'Memory使用率'},
                                                {value: 10, name: '空闲'},
                                            ]
                                        }
                                    ]
                            };
                            memory_pie_chart.setOption(memory_pie_chart_option);
                          </script>
                      </div>

                  <!--Memory实时数据的数字-->
                  <div class="col-sm-6">
                      <p class="font-weight-light text-center">Real Time</p>
                      <p class="font-weight-light text-center">Memory Utility Rate</p>
                      <p class="text-center font-weight-bold lead" id="memory_real_time_data">Loading...</p>
                  </div>
                  </div>
              </div>
          </div>
      </div>

      <!--右2 Disk Pie Chart-->
      <div class="col-sm-3">
          <!--声明一个新卡片-->
          <div class="card card-chart">

              <!--卡片的头部-->
              <div class="card-header bg-white">
                <h4 class="text-center"><small>Disk</small></h4>
              </div>

              <!--卡片的主体-->
              <div class="card-body bg-white">

                  <!--Disk实时数据的图-->
                  <div class="row">
                      <div class="col-sm-6">

                          <!--声明用来放Disk Pie Chart的DOM-->
                          <div id="disk_pie_chart" style="width: 100%;height:150px;"></div>

                          <!--初始化Disk Pie Chart-->
                          <script>
                              var disk_pie_chart = echarts.init(document.getElementById('disk_pie_chart'));
                              var disk_pie_chart_option = {
                                    tooltip: {
                                    trigger: 'item',
                                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                                    },
                                    color:['green', 'white'],
                                    series: [
                                        {
                                            name: 'Disk',
                                            type: 'pie',
                                            radius: ['50%', '70%'],
                                            avoidLabelOverlap: false,
                                            label: {
                                                normal: {
                                                position: 'inner',
                                                show : false
                                                }
                                            },
                                            labelLine:{
                                                show: false
                                            },
                                            emphasis: {
                                                label: {
                                                    show: true,
                                                    fontSize: '30',
                                                    fontWeight: 'bold'
                                                }
                                            },
                                            data: [
                                                {value: 90, name: 'Disk使用率'},
                                                {value: 10, name: '空闲'},
                                            ]
                                        }
                                    ]
                            };
                            disk_pie_chart.setOption(disk_pie_chart_option);
                          </script>
                      </div>

                  <!--Disk实时数据的数字-->
                  <div class="col-sm-6">
                      <p class="font-weight-light text-center">Real Time</p>
                      <p class="font-weight-light text-center">Disk Utility Rate</p>
                      <p class="text-center font-weight-bold lead" id="disk_real_time_data">Loading...</p>
                  </div>
                  </div>
              </div>
          </div>
      </div>

      <!--右1 Network Pie Chart-->
      <div class="col-sm-3">
          <!--声明一个新卡片-->
          <div class="card card-chart">

              <!--卡片的头部-->
              <div class="card-header bg-white">
                <h4 class="text-center"><small>Network</small></h4>
              </div>

              <!--卡片的主体-->
              <div class="card-body bg-white">

                  <!--Network实时数据的图-->
                  <div class="row">
                      <div class="col-sm-6">

                          <!--声明用来放Network Pie Chart的DOM-->
                          <div id="network_pie_chart" style="width: 100%;height:150px;"></div>

                          <!--初始化Network Pie Chart-->
                          <script>
                              var network_pie_chart = echarts.init(document.getElementById('network_pie_chart'));
                              var network_pie_chart_option = {
                                    tooltip: {
                                    trigger: 'item',
                                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                                    },
                                    color:['green', 'white'],
                                    series: [
                                        {
                                            name: 'Network',
                                            type: 'pie',
                                            radius: ['50%', '70%'],
                                            avoidLabelOverlap: false,
                                            label: {
                                                normal: {
                                                position: 'inner',
                                                show : false
                                                }
                                            },
                                            labelLine:{
                                                show: false
                                            },
                                            emphasis: {
                                                label: {
                                                    show: true,
                                                    fontSize: '30',
                                                    fontWeight: 'bold'
                                                }
                                            },
                                            data: [
                                                {value: 90, name: 'Network使用率'},
                                                {value: 10, name: '空闲'},
                                            ]
                                        }
                                    ]
                            };
                            network_pie_chart.setOption(network_pie_chart_option);
                          </script>
                      </div>

                  <!--Network实时数据的数字-->
                  <div class="col-sm-6">
                      <p class="font-weight-light text-center">Real Time</p>
                      <p class="font-weight-light text-center">Network Utility Rate</p>
                      <p class="text-center font-weight-bold lead" id="network_real_time_data">Loading...</p>
                  </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!--放置三张Line Chart的行-->
  <div class="row bg-white">

      <!--左 Memory Line Chart-->
      <div class="col-sm-4 bg-white">
          <!--声明一个新卡片-->
          <div class="card card-chart">

              <!--卡片的头部-->
              <div class="card-header bg-white">
                  <h6 class="card-title">Memory Utility Rate</h6>
              </div>

              <!--卡片的主体-->
              <div class="card-body bg-white">

              </div>

          </div>
      </div>

      <!--中 Disk Line Chart-->
      <div class="col-sm-4 bg-white"></div>

      <!--右 Network Line Chart-->
      <div class="col-sm-4 bg-white"></div>
  </div>
</div>
</body>
</html>


<!--定义作用于全局的JavaScript函数和变量-->
<script>
//声明存储系统信息的全局变量
    var server_info
    var real_time_server_info

//返回格式化的时间(HH:MM)
        function getCurrentTime(){
		var dtCur = new Date();
		var hCur = dtCur.getHours();
		var mCur = dtCur.getMinutes();
		timeCur = (hCur < 10 ? "0" + hCur : hCur) + ":" + (mCur < 10 ? "0" + mCur : mCur);
		return timeCur;
	}
//返回格式化的时间(HH:MM:SS)
        function getCurrentTime_seconds(){
		var dtCur = new Date();
		var hCur = dtCur.getHours();
		var mCur = dtCur.getMinutes();
		var sCur = dtCur.getSeconds();
		timeCur = (hCur < 10 ? "0" + hCur : hCur) + ":" + (mCur < 10 ? "0" + mCur : mCur) + ":" + (sCur < 10 ? "0" + sCur : sCur);
		return timeCur;
	}
// 定时每分钟异步获取系统信息
        timeTicket = setInterval(function () {
        $.ajax({
            type:'GET',
            url:'/admin/server-info-api',
            dataType:'json',
            success:function(json)
                {
                    server_info = eval(json);
                    cpu_date.push(getCurrentTime());
                    cpu_data.push(server_info.cpu);
                    cpuChart.setOption({
                    xAxis: {
                        data: cpu_date
                    },
                    series: [{
                        name:'',
                        data: cpu_data
                    }]
                });
                }
        });
    }, 60000);
// 定时每秒异步获取系统信息
        timeTicket = setInterval(function () {
        $.ajax({
            type:'GET',
            url:'/admin/server-info-api',
            dataType:'json',
            success:function(json)
                {
                    real_time_server_info = eval(json);

                    // 获取各项指标的值
                    cpu_real_time_data = real_time_server_info.cpu
                    memory_real_time_data = real_time_server_info.memory
                    disk_real_time_data = real_time_server_info.disk
                    network_real_time_data = real_time_server_info.network

                    // 将实时数据显示在前端
                    document.getElementById('cpu_real_time_data').innerHTML = cpu_real_time_data + '%'
                    document.getElementById('memory_real_time_data').innerHTML = memory_real_time_data + '%'
                    document.getElementById('disk_real_time_data').innerHTML = disk_real_time_data + '%'
                    document.getElementById('network_real_time_data').innerHTML = network_real_time_data + 'MB/s'

                    // 使用实时数据更新前端Pie Chart
                    cpu_pie_chart.setOption({
                        series: [{
                            data: [
                                {value: cpu_real_time_data, name: 'CPU使用率'},
                                {value: 100 - cpu_real_time_data, name: '空闲'},
                            ]
                        }]
                    });
                    memory_pie_chart.setOption({
                        series: [{
                            data: [
                                {value: memory_real_time_data, name: 'Memory使用率'},
                                {value: 100 - memory_real_time_data, name: '空闲'},
                            ]
                        }]
                    });
                    disk_pie_chart.setOption({
                        series: [{
                            data: [
                                {value: disk_real_time_data, name: 'Disk使用率'},
                                {value: 100 - disk_real_time_data, name: '空闲'},
                            ]
                        }]
                    });
                    //需要根据不同服务器的实时带宽不同修改上限
                    network_pie_chart.setOption({
                        series: [{
                            data: [
                                {value: network_real_time_data, name: '每秒上传+下载的总量'},
                                {value: 3 - network_real_time_data, name: '空'},
                            ]
                        }]
                    });
                }
        });
    }, 1000);
</script>